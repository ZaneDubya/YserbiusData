#include "defines.loh"
#include "flags.loh"

#define PIGFOOT 1

fun MapEvent01(context) {
    context.ShowText("This gateway leads to the Foyer of Cawdor.");
}

fun MapEvent02(context) {
    context.ShowText("A: This wyrd sister lives no more");
}

fun MapEvent03(context) {
    context.ShowText("A: Save words here writ in living stone.");
}

fun MapEvent04(context) {
    context.ShowText("A: And for a life knee deep in gore");
}

fun MapEvent05(context) {
    context.ShowText("A: Beyond the grave I must atone.");
}

fun MapEvent06(context) {
    context.ShowText("A: Cawdor's bones are full of beasts.");
}

fun MapEvent07(context) {
    context.ShowText("A: Thy challenge: to defeat them.");
}

fun MapEvent08(context) {
    context.ShowText("A: To help my soul I can at least");
}

fun MapEvent09(context) {
    context.ShowText("A: Leave hints an thou canst read them.");
}

fun MapEvent0A(context) {
    context.ShowText("A: Each clue thou findst upon these walls");
}

fun MapEvent0B(context) {
    context.ShowText("A: Is split in sections various.");
}

fun MapEvent0C(context) {
    context.ShowText("A: Together they will tell thee all");
}

fun MapEvent0D(context) {
    context.ShowText("A: To kill the most nefarious.");
}

fun MapEvent0E(context) {
    context.ShowText("A: Not all my clues are openly writ.");
}

fun MapEvent0F(context) {
    context.ShowText("A: Some messages are obscure.");
}

fun MapEvent10(context) {
    context.ShowText("A: But when deciphered by thine own wit");
}

fun MapEvent11(context) {
    context.ShowText("A: Thy victory they'll ensure.");
}

fun MapEvent12(context) {
    context.ShowRunes("B: Cawdor's doors have mighty wards,");
}

fun MapEvent13(context) {
    context.ShowRunes("B: Protections hale and hearty.");
}

fun MapEvent14(context) {
    context.ShowRunes("B: An thou wouldst earn thy just rewards");
}

fun MapEvent15(context) {
    context.ShowRunes("B: Thou wilt need a balanced party.");
}

fun MapEvent16(context) {
    context.ShowText("B: Thou canst not force an entryway");
}

fun MapEvent17(context) {
    context.ShowText("B: Be thou strong or willful.");
}

fun MapEvent18(context) {
    context.ShowText("B: But oft a group can make their way");
}

fun MapEvent19(context) {
    context.ShowText("B: As can a thief most skillful.");
}

fun MapEvent1A(context) {
    context.ShowRunes("The Brinded Cat is a giant beast; ");
    context.ShowRunes("Its fur is hard and curly. ");
    context.ShowRunes("But it cannot resist the power ");
    context.ShowRunes("Of the mighty Hurlyburly.");
}

fun MapEvent1B(context) {
    context.ShowRunes("The Harpier's bite can strike thee dead,");
    context.ShowRunes("Diseased and full of blindness.");
    context.ShowRunes("But thou canst face its awesome dread,");
    context.ShowRunes("With the Milk of Human Kindness.");
}

fun MapEvent1C(context) {
    context.ShowRunes("The dragon, fenny snake, and wolf,");
    context.ShowRunes("The adder, newt, and frog,");
    context.ShowRunes("The blind-worm, bat, goat, and witch,");
    context.ShowRunes("The lizard, howlet, and dog,");
    context.ShowRunes("Use thou which they do have within,");
    context.ShowRunes("To drive them full agog.");
}

fun MapEvent1D(context) {
    context.ShowRunes("King Hadrian's great masonic fame,");
    context.ShowRunes("Was his engirdling wall.");
    context.ShowRunes("The Shield thou finds that bears his name");
    context.ShowRunes("Ensures that thou won't fall.");
}

fun MapEvent1E(context) {
    context.ShowRunes("Hilda, Whitby's Abbess,");
    context.ShowRunes("Healed with her self-named glove.");
    context.ShowRunes("Streoneshalh, the mail of plate,");
    context.ShowRunes("Defends with Hilda's love.");
}

fun MapEvent1F(context) {
    context.ShowRunes("The Scramasax the Picts did use");
    context.ShowRunes("Its poisons did not scare them.");
    context.ShowRunes("An thou dost find such doughty blades,");
    context.ShowRunes("Then let thy foes beware them.");
}

fun MapEvent20(context) {
    context.ShowRunes("When things are bleak, thy foes are nigh,");
    context.ShowRunes("The darkness seems most Stygian,");
    context.ShowRunes("An thou wouldst find help from on high,");
    context.ShowRunes("Then use the Cap of Phrygian.");
}

fun MapEvent21(context) {
    context.ShowRunes("When runes are seen yet make no sense,");
    context.ShowRunes("They set thy head to stewin'");
    context.ShowRunes("There's still a chance: do not be tense.");
    context.ShowRunes("An thou hast the Cap of Alcuin.");
    context.ShowRunes("But 'ware the usage of the cap.");
    context.ShowRunes("Thou wilt not be overjoyed.");
    context.ShowRunes("An thou dost use it like foolscap");
    context.ShowRunes("Thou wilt find thy cap destroyed.");
}

fun MapEvent22(context) {
    context.ShowRunes("D: gYoun allcomM saw a volley dal");
}

fun MapEvent23(context) {
    context.ShowRunes("D: siH cafe thob raif dan swimone");
}

fun MapEvent24(context) {
    context.ShowRunes("D: If hout muts ghfti mih hent eb dlag");
}

fun MapEvent25(context) {
    context.ShowRunes("D: uToh wares het rnwoC of soCimrn");
}

fun MapEvent26(context) {
    context.ShowRunes("E: Mdgi moysry ie hpt Lhtsashi");
}

fun MapEvent27(context) {
    context.ShowRunes("E: 'Ttg hsio ta mrrr hge sdkeeaa");
}

fun MapEvent28(context) {
    context.ShowRunes("E: Utplus teys hahh a mrgstro giin");
}

fun MapEvent29(context) {
    context.ShowRunes("E: Agg wadddi a Lleeee Darnns.");
}

fun MapEvent2A(context) {
    context.ShowRunes("J: Tk dBfg oiea ihlaneol dqrsuctoe' ssome");
}

fun MapEvent2B(context) {
    context.ShowRunes("J: Tnbt fhewal oeo nyudnis entrgs");
}

fun MapEvent2C(context) {
    context.ShowRunes("J: TBt otkhhh lhn hii oeue ealss etl t'ss");
}

fun MapEvent2D(context) {
    context.ShowRunes("J: TOs hdhrei yeat min ngsge.");
}

fun MapEvent2E(context) {
    var i;
    i = context.GetFlag(DUNGEON, CAPCOUNTER);
    i++;
    if (context.UsedItem(ALCUINSCAP, ALCUINSCAP)) {
        if (i > 6) {
            i = 0;
            context.TakeItem(ALCUINSCAP);
        }
        context.SetFlag(DUNGEON, CAPCOUNTER, i);
        context.ShowText("Alcuin's cap glows warm to the touch.  You can read the runes!");
        context.ShowText("F: Macduff's heroic fighting spirit.");
    }
    else {
        context.ShowRunes("F: sashfff'rherMocugdctingiiiipt");
    }
}

fun MapEvent2F(context) {
    var i;
    i = context.GetFlag(DUNGEON, CAPCOUNTER);
    i++;
    if (context.UsedItem(ALCUINSCAP, ALCUINSCAP)) {
        if (i > 6) {
            i = 0;
            context.TakeItem(ALCUINSCAP);
        }
        context.SetFlag(DUNGEON, CAPCOUNTER, i);
        context.ShowText("Alcuin's cap glows warm to the touch.  You can read the runes!");
        context.ShowText("F: Will set thy face to frowning.");
    }
    else {
        context.ShowRunes("F: illsetttcygaehirooffwWnn.");
    }
}

fun MapEvent30(context) {
    var i;
    i = context.GetFlag(DUNGEON, CAPCOUNTER);
    i++;
    if (context.UsedItem(ALCUINSCAP, ALCUINSCAP)) {
        if (i > 6) {
            i = 0;
            context.TakeItem(ALCUINSCAP);
        }
        context.SetFlag(DUNGEON, CAPCOUNTER, i);
        context.ShowText("Alcuin's cap glows warm to the touch.  You can read the runes!");
        context.ShowText("F: If thou wouldst know how not to fear it");
    }
    else {
        context.ShowRunes("F: Iiahhuuldsknwwwnooooootttttffre");
    }
}

fun MapEvent31(context) {
    var i;
    i = context.GetFlag(DUNGEON, CAPCOUNTER);
    i++;
    if (context.UsedItem(ALCUINSCAP, ALCUINSCAP)) {
        if (i > 6) {
            i = 0;
            context.TakeItem(ALCUINSCAP);
        }
        context.SetFlag(DUNGEON, CAPCOUNTER, i);
        context.ShowText("Alcuin's cap glows warm to the touch.  You can read the runes!");
        context.ShowText("F: Then use the Cup of Drowning.");
    }
    else {
        context.ShowRunes("F: TtCfDsroowighheeennnuup.");
    }
}

fun MapEvent32(context) {
    var i;
    i = context.GetFlag(DUNGEON, CAPCOUNTER);
    i++;
    if (context.UsedItem(ALCUINSCAP, ALCUINSCAP)) {
        if (i > 6) {
            i = 0;
            context.TakeItem(ALCUINSCAP);
        }
        context.SetFlag(DUNGEON, CAPCOUNTER, i);
        context.ShowText("Alcuin's cap glows warm to the touch.  You can read the runes!");
        context.ShowText("G: Macbeth's shade is strongest of all");
    }
    else {
        context.ShowRunes("G: aaaaaaaaa abbBc cc dddeeeeee ee eee");
    }
}

fun MapEvent33(context) {
    var i;
    i = context.GetFlag(DUNGEON, CAPCOUNTER);
    i++;
    if (context.UsedItem(ALCUINSCAP, ALCUINSCAP)) {
        if (i > 6) {
            i = 0;
            context.TakeItem(ALCUINSCAP);
        }
        context.SetFlag(DUNGEON, CAPCOUNTER, i);
        context.ShowText("Alcuin's cap glows warm to the touch.  You can read the runes!");
        context.ShowText("G: But an thou earns his pocket");
    }
    else {
        context.ShowRunes("G: ffg gh hhhh hhhhH iii iikkll");
    }
}

fun MapEvent34(context) {
    var i;
    i = context.GetFlag(DUNGEON, CAPCOUNTER);
    i++;
    if (context.UsedItem(ALCUINSCAP, ALCUINSCAP)) {
        if (i > 6) {
            i = 0;
            context.TakeItem(ALCUINSCAP);
        }
        context.SetFlag(DUNGEON, CAPCOUNTER, i);
        context.ShowText("Alcuin's cap glows warm to the touch.  You can read the runes!");
        context.ShowText("G: Then in thy hands mayhaps will fall");
    }
    else {
        context.ShowRunes("G: llll ll LmM nnnnn nnooooo pprr ssss");
    }
}

fun MapEvent35(context) {
    var i;
    i = context.GetFlag(DUNGEON, CAPCOUNTER);
    i++;
    if (context.UsedItem(ALCUINSCAP, ALCUINSCAP)) {
        if (i > 6) {
            i = 0;
            context.TakeItem(ALCUINSCAP);
        }
        context.SetFlag(DUNGEON, CAPCOUNTER, i);
        context.ShowText("Alcuin's cap glows warm to the touch.  You can read the runes!");
        context.ShowText("G: The blessed Healing Locket.");
    }
    else {
        context.ShowRunes("G: sss ssssttt tttttTT uuwyy'");
    }
}

fun MapEvent36(context) {
    context.ShowRunes("H:  Thou hast solved clues that I did brew");
    context.ShowRunes("H:  With means anagrammatic.");
    context.ShowRunes("H:  But these last clues are those that thou");
    context.ShowRunes("H:  Solve with means cryptographic.");
}

fun MapEvent37(context) {
    if (context.UsedItem(ALCUINSCAP, ALCUINSCAP)) {
        context.TakeItem(ALCUINSCAP);
        context.SetFlag(DUNGEON, CAPCOUNTER, 0);
        context.ShowText("Alcuin's cap glows red hot, and then dissolves into wisps of steam.  But at least you get to read the runes!");
        context.ShowText("I: The Healing Locket's all that might");
        context.ShowText("I: Ward off my sisters's power.");
        context.ShowText("I: Use it steadfastly through the fight");
        context.ShowText("I: And watch it make them glower.");
    }
    else {
        context.ShowRunes("I:  Bkw Kwqgmoy Glhuwb'c qgg bkqb amykb");
        context.ShowRunes("I:  Nqti ljj ap cmcbwtc'c flnwt.");
        context.ShowRunes("I:  Scw mb cbwqijqcbgp bktlsyk bkw jmykb");
        context.ShowRunes("I:  Qoi nqbhk mb aquw bkwa yglnwt.");
    }
}

fun MapEvent38(context) {
    if ((context.GetFlag(DUNGEON, MACBETHREWARD) == 0) && (context.GetFlag(DUNGEON, WONGAME) == 0)) {
        context.ShowText("The doors refuse to budge.");
    }
    else {
        if (context.PartyCount > 1) {
            context.ShowText("These narrow stairs will force you to descend single file.");
        }
        else {
            context.ShowText("Whoever last passed these doors did not pull them to.  You carefully make sure they stay ajar as you pass.  They lead to stairs descending into darkness.");
            if (((context.HasItem(ALDHELMSSTAFF)) && (context.HasItem(ALDHELMSGAUNTLETS)) && (context.HasItem(ALDHELMSHARP)) && (context.GetFlag(DUNGEON, ALDHELMPROPHECY) == 1)) || (context.GetFlag(DUNGEON, ALDHELMBLESSING) == 1)) {
                context.ShowText("A beatific figure, old, wise, and happy, appears before you.");
                context.ShowText("'I am Aldhelm.  Long have I hoped to aid one of good heart in ridding this earth of the canker of the Wyrd Sisters.");
                context.ShowText("There is a secret path, somewhat safer, that will lead thee to thy goal.  It will bypass many fiercesome beasts set here to sap thy will and vigor.  Take it, and my blessing.'");
                if (!(context.HasItem(LANTERN))) {
                    context.GiveItem(LANTERN);
                }
                context.SetFlag(DUNGEON, ALDHELMBLESSING, 1);
                context.Teleport(10, 2, 0, EAST);
            }
            else {
                context.Teleport(10, 2, 16, EAST);
            }
        }
    }
}

fun MapEvent39(context) {
    context.Teleport(1, 1, 175, WEST);
}

fun MapEvent3A(context) {
    context.SetFlag(DUNGEON, BEENINRUNEDROOM, 1);
}

fun MapEvent3C(context) {
    context.ShowRunes("C:  Fancel epadsce teh mrrrduee's balde");
}

fun MapEvent3D(context) {
    context.ShowRunes("C:  Btu he sllit flees hsi golom.");
}

fun MapEvent3E(context) {
    context.ShowRunes("C:  If thuo wosdutl bets daeeft hsi shead");
}

fun MapEvent3F(context) {
    context.ShowRunes("C:  Tehn wedil teh Cckar of Dmoo.");
}

fun MapEvent40(context) {
    if (context.GetFlag(DUNGEON, HEARDJOKE1) == 0) {
        context.SetFlag(DUNGEON, HEARDJOKE1, 1);
        context.ShowPicture(DRAGON);
        context.ShowText("*");
        context.ShowText("*");
        context.ShowText("*");
        context.ShowText("By all the fins and feathers!  An enormous red dragon rears up and speaks to you.");
        if ((context.GetFlag(DUNGEON, HEARDJOKE4) == 0) && (context.GetFlag(DUNGEON, HEARDJOKE2) == 0) && (context.GetFlag(DUNGEON, HEARDJOKE3) == 0)) {
            context.ShowText("'Hmm.  There are two ways this could go.  We could have similar senses of humor, and part friends, or I could just eat thee.  So.  Wouldst hear a joke about a stupid green dragon named Gwalter the Dim?'");
        }
        else {
            context.ShowText("'Ah!  I remember thee.  As I recall, thou didst enjoy my last joke.  Wouldst thou hear another?'");
        }
        context.ShowText("You quickly nod.");
        context.ShowText("'There was a very stupid green dragon named Gwalter the Dim.  Do not laugh yet!  One day Gwalter received three wishes from a djinn.  For his first wish he asked for a bag that would always be full of gold, no matter how much he removed.  Lo and behold!  His wish was granted.");
        context.ShowText("The genie asked what he wanted for his other wishes.  Gwalter asked for two more of those bags.  Get it?'");
        context.ShowText("You laugh politely.");
        context.ShowText("'Good enough.  But remember; 'tis only the green drakes that exhibit such stupidity.  I shall remember thee.'");
        context.ShowText("The dragon departs.");
    }
}

fun MapEvent41(context) {
    if (context.GetFlag(PARTY, PIGFOOT) == 0) {
        context.SetFlag(PARTY, PIGFOOT, 1);
        context.ShowPicture(HALFLINGCLERIC);
        context.ShowText("A halfling cleric approaches you surreptitiously.");
        context.ShowText("'Psst!  Cuz!  Thou dost look like a being of wit and wisdom.  I will gladly share with thee a great secret.'");
        context.ShowText("He opens his coat to show, pinned to the inside, a slightly turned pig's foot.");
        context.ShowText("'This is the Lucky Pig's Foot.  It is the sovereign against dragons, for wyrms cannot abide the smell of burnt pig's foot.  Thou needst only to brandish it boldly before thee in battle....'");
        context.ShowText("His voice trails off as he sees someone approaching, waving another lucky pig's foot.  'Anon!'");
    }
}
